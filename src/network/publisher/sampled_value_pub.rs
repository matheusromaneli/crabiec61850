use crate::{network::{packet::Packet, socket::RawSocket}, protocols::{ethernet::model::Ethernet, sampled_values::model::SampledValue}};

pub fn main() {
    let socket = RawSocket::new("lo".to_string(), 0x88ba_u16);

    let sv_bytes: &[u8] = &[
        0x40, 0x02, 0x00, 0x66, 0x00, 0x00, 0x00, 0x00, // Header
        0x60, 0x5c, // PDU
        0x80, 0x01, 0x01, // number of ASDU
        0xa2, 0x57, // sequence of ASDU
        0x30, 0x55, 0x80, 0x04, 0x34, 0x30, 0x30, 0x30, 0x82, 0x02, 0x00, 0x00, 0x83, 0x04, 0x00, 0x00, 0x00,
        0x01, 0x85, 0x01, 0x01, 0x87, 0x40, 0xff, 0xff, 0xff, 0xfd, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x03, 0x00, 0x00, 0x20, 0x00, 0xff, 0xff, 0xff, 0xfd, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0xff, 0xfd, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff,
        0xff, 0xf6, 0x00, 0x00, 0x20, 0x00 // ASDU
    ];
    let mut config = Packet {
        ether_type: [0x88, 0xba],
        ethernet: Ethernet{
            dst_mac: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
            src_mac: [0x00, 0x00, 0x00, 0x00, 0x00, 0x00],
            ether_type: [0x88, 0xba],
        },
        sampled_value: SampledValue::from_bytes(sv_bytes),
    };

    loop {
        socket.send(config.to_bytes());
        config.sampled_value.next();
    }
}